<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Octopus Easy Mode</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .table td i {
            margin-top: 1rem;
        }
        .table tbody tr {
            border-top: 2rem solid transparent;
        }
        .table tbody tr:first-child {
            border-top: none;
        }
        .table {
            border-collapse: separate;
            border-spacing: 0.5rem;
        }
        .platform-cell {
            cursor: pointer;
            transition: background-color 0.2s;
            padding: 1.5rem 1rem;
            border-radius: 0.5rem;
        }
        .platform-cell:hover {
            background-color: #f8f9fa;
        }
        .platform-cell.selected {
            background-color: #0d6efd;
            color: white;
        }
        .platform-cell.selected i {
            color: white;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <script type="module">
        import { h, render } from 'https://esm.sh/preact';
        import { useState } from 'https://esm.sh/preact/hooks';
        import htm from 'https://esm.sh/htm';
        const html = htm.bind(h);

        function App() {
            const [selectedPlatform, setSelectedPlatform] = useState('kubernetes');
            const [selectedTenant, setSelectedTenant] = useState(null);
            const [selectedRunbooks, setSelectedRunbooks] = useState([]);
            const [selectedFreeze, setSelectedFreeze] = useState(null);
            const [selectedChannels, setSelectedChannels] = useState([]);
            const [promptText, setPromptText] = useState('Create a Kubernetes project called "My K8s WebApp"');

            const platforms = [
                { id: 'kubernetes', name: 'Kubernetes', icon: 'fas fa-dharmachakra', prompt: 'Create a Kubernetes project called "My K8s WebApp"' },
                { id: 'argocd', name: 'Argo CD', icon: 'fas fa-circle-nodes', prompt: 'Create an Argo CD project called "My Argo CD WebApp"' },
                { id: 'azurewebapp', name: 'Azure Web App', icon: 'fab fa-microsoft', prompt: 'Create an Azure Web App project called "My Azure WebApp"' },
                { id: 'azurefunctions', name: 'Azure Functions', icon: 'fas fa-bolt', prompt: 'Create an Azure Functions project called "My Azure Function App"' },
                { id: 'awslambda', name: 'AWS Lambda', icon: 'fab fa-aws', prompt: 'Create an AWS Lambda project called "My AWS Lambda App"' },
                { id: 'scriptstep', name: 'Script Step', icon: 'fas fa-terminal', prompt: 'Create a script project called "My Script App"' }
            ];

            const tenants = [
                { id: 'regional', name: 'Regional', icon: 'fas fa-globe', instruction: '* Add 5 tenants based on geographical regions' },
                { id: 'physical', name: 'Physical', icon: 'fas fa-building', instruction: '* Add 5 tenants based on random brick and mortar store names' },
                { id: 'businessunit', name: 'Business Unit', icon: 'fas fa-sitemap', instruction: '* Add 5 tenants based on random business unit names' },
                { id: 'company', name: 'Company', icon: 'fas fa-briefcase', instruction: '* Add 5 tenants based on fictional company names' }
            ];

            const runbooks = [
                { id: 'database', name: 'Database', icon: 'fas fa-database', instruction: '* Add a runbook to simulate a database backup' },
                { id: 'service', name: 'Service', icon: 'fas fa-cogs', instruction: '* Add a runbook to simulate the restart of the service' },
                { id: 'logs', name: 'Logs', icon: 'fas fa-file-alt', instruction: '* Add a runbook to simulate the retrival of logs' }
            ];

            const freezes = [
                { id: 'christmas', name: 'Christmas', icon: 'fas fa-tree', instruction: '* Create a global freeze for Christmas' },
                { id: 'newyear', name: 'New Year', icon: 'fas fa-champagne-glasses', instruction: '* Create a global freeze for New Year' },
                { id: 'blackfriday', name: 'Black Friday', icon: 'fas fa-tag', instruction: '* Create a global freeze for Black Friday' },
                { id: 'cybermonday', name: 'Cyber Monday', icon: 'fas fa-laptop', instruction: '* Create a global freeze for Cyber Monday' }
            ];

            const channels = [
                { id: 'hotfix', name: 'Hot Fix', icon: 'fas fa-fire-extinguisher', instruction: '* Create a Hot Fix channel' },
                { id: 'featurebranch', name: 'Feature Branch', icon: 'fas fa-code-branch', instruction: '* Create a Feature Branch channel' }
            ];

            const generatePrompt = (platformId, tenantId, runbookIds, freezeId, channelIds) => {
                const platform = platforms.find(p => p.id === platformId);
                if (!platform) return '';

                let prompt = platform.prompt;
                const additionalInstructions = [];

                if (tenantId) {
                    const tenant = tenants.find(t => t.id === tenantId);
                    if (tenant && tenant.instruction) {
                        additionalInstructions.push(tenant.instruction);
                    }
                }

                if (runbookIds && runbookIds.length > 0) {
                    runbookIds.forEach(runbookId => {
                        const runbook = runbooks.find(r => r.id === runbookId);
                        if (runbook && runbook.instruction) {
                            additionalInstructions.push(runbook.instruction);
                        }
                    });
                }

                if (freezeId) {
                    const freeze = freezes.find(f => f.id === freezeId);
                    if (freeze && freeze.instruction) {
                        additionalInstructions.push(freeze.instruction);
                    }
                }

                if (channelIds && channelIds.length > 0) {
                    channelIds.forEach(channelId => {
                        const channel = channels.find(c => c.id === channelId);
                        if (channel && channel.instruction) {
                            additionalInstructions.push(channel.instruction);
                        }
                    });
                }

                if (additionalInstructions.length > 0) {
                    prompt += ', and then:\n' + additionalInstructions.join('\n');
                }

                return prompt;
            };

            const handlePlatformClick = (platformId) => {
                if (selectedPlatform === platformId) return;
                setSelectedPlatform(platformId);
                setPromptText(generatePrompt(platformId, selectedTenant, selectedRunbooks, selectedFreeze, selectedChannels));
            };

            const handleTenantClick = (tenantId) => {
                const newTenantId = selectedTenant === tenantId ? null : tenantId;
                setSelectedTenant(newTenantId);
                setPromptText(generatePrompt(selectedPlatform, newTenantId, selectedRunbooks, selectedFreeze, selectedChannels));
            };

            const handleRunbookClick = (runbookId) => {
                const newRunbooks = selectedRunbooks.includes(runbookId)
                    ? selectedRunbooks.filter(id => id !== runbookId)
                    : [...selectedRunbooks, runbookId];
                setSelectedRunbooks(newRunbooks);
                setPromptText(generatePrompt(selectedPlatform, selectedTenant, newRunbooks, selectedFreeze, selectedChannels));
            };

            const handleFreezeClick = (freezeId) => {
                const newFreezeId = selectedFreeze === freezeId ? null : freezeId;
                setSelectedFreeze(newFreezeId);
                setPromptText(generatePrompt(selectedPlatform, selectedTenant, selectedRunbooks, newFreezeId, selectedChannels));
            };

            const handleChannelClick = (channelId) => {
                const newChannels = selectedChannels.includes(channelId)
                    ? selectedChannels.filter(id => id !== channelId)
                    : [...selectedChannels, channelId];
                setSelectedChannels(newChannels);
                setPromptText(generatePrompt(selectedPlatform, selectedTenant, selectedRunbooks, selectedFreeze, newChannels));
            };

            const handleCopyToClipboard = () => {
                navigator.clipboard.writeText(promptText).then(() => {
                    alert('Prompt copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                });
            };

            return html`
                <div class="container mt-5">
                    <h1 class="mb-4">Octopus Easy Mode</h1>
                    <table class="table">
                        <tbody>
                            <tr>
                                <th scope="row">Platform</th>
                                ${platforms.map(platform => html`
                                    <td
                                        class="text-center platform-cell ${selectedPlatform === platform.id ? 'selected' : ''}"
                                        onClick=${() => handlePlatformClick(platform.id)}
                                    >
                                        ${platform.name}<br/>
                                        <i class="${platform.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <th scope="row">Tenants</th>
                                ${tenants.map(tenant => html`
                                    <td
                                        class="text-center platform-cell ${selectedTenant === tenant.id ? 'selected' : ''}"
                                        onClick=${() => handleTenantClick(tenant.id)}
                                    >
                                        ${tenant.name}<br/>
                                        <i class="${tenant.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <th scope="row">Runbooks</th>
                                ${runbooks.map(runbook => html`
                                    <td
                                        class="text-center platform-cell ${selectedRunbooks.includes(runbook.id) ? 'selected' : ''}"
                                        onClick=${() => handleRunbookClick(runbook.id)}
                                    >
                                        ${runbook.name}<br/>
                                        <i class="${runbook.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <th scope="row">Freezes</th>
                                ${freezes.map(freeze => html`
                                    <td
                                        class="text-center platform-cell ${selectedFreeze === freeze.id ? 'selected' : ''}"
                                        onClick=${() => handleFreezeClick(freeze.id)}
                                    >
                                        ${freeze.name}<br/>
                                        <i class="${freeze.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <th scope="row">Channels</th>
                                ${channels.map(channel => html`
                                    <td
                                        class="text-center platform-cell ${selectedChannels.includes(channel.id) ? 'selected' : ''}"
                                        onClick=${() => handleChannelClick(channel.id)}
                                    >
                                        ${channel.name}<br/>
                                        <i class="${channel.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                        </tbody>

                    </table>

                    <div class="mt-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="mb-0">Prompt</h3>
                            <button class="btn btn-primary" onClick=${handleCopyToClipboard}>
                                <i class="fas fa-copy me-2"></i>Copy to clipboard
                            </button>
                        </div>
                        <textarea
                            class="form-control"
                            rows="10"
                            placeholder="Enter your prompt here..."
                            value=${promptText}
                            onInput=${(e) => setPromptText(e.target.value)}
                        ></textarea>
                    </div>
                </div>
            `;
        }

        render(html`<${App} />`, document.getElementById('app'));
    </script>
</body>
</html>

