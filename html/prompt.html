<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Octopus Easy Mode</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .table td i {
            margin-top: 1rem;
        }
        .table tbody tr {
            border-top: 2rem solid transparent;
        }
        .table tbody tr:first-child {
            border-top: none;
        }
        .table {
            border-collapse: separate;
            border-spacing: 0.5rem;
            table-layout: fixed;
        }
        .table th {
            width: 150px;
            border-width: 0;
        }
        .table td {
            width: auto;
            border-width: 0;
        }
        .platform-cell {
            cursor: pointer;
            transition: background-color 0.2s;
            padding: 1.5rem 1rem;
            border-radius: 0.5rem;
        }
        .platform-cell:hover {
            background-color: #f8f9fa;
        }
        .platform-cell.selected {
            background-color: #0d6efd;
            color: white;
        }
        .platform-cell.selected i {
            color: white;
        }
        .platform-cell.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        .disabled-message {
            color: #dc3545;
            font-size: 0.875rem;
            font-style: italic;
            margin-top: 0.25rem;
        }
        .copy-btn {
            min-width: 200px;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <script type="module">
        import { h, render } from 'https://esm.sh/preact';
        import { useState, useEffect } from 'https://esm.sh/preact/hooks';
        import htm from 'https://esm.sh/htm';
        const html = htm.bind(h);

        function App() {
            // Load initial state from localStorage or use defaults
            const loadFromStorage = (key, defaultValue) => {
                try {
                    const saved = localStorage.getItem(key);
                    return saved !== null ? JSON.parse(saved) : defaultValue;
                } catch (e) {
                    console.error('Error loading from localStorage:', e);
                    return defaultValue;
                }
            };

            const [selectedPlatform, setSelectedPlatform] = useState(() => loadFromStorage('selectedPlatform', 'kubernetes'));
            const [selectedExampleSteps, setSelectedExampleSteps] = useState(() => loadFromStorage('selectedExampleSteps', []));
            const [selectedTenant, setSelectedTenant] = useState(() => loadFromStorage('selectedTenant', null));
            const [selectedRunbooks, setSelectedRunbooks] = useState(() => loadFromStorage('selectedRunbooks', []));
            const [selectedChannels, setSelectedChannels] = useState(() => loadFromStorage('selectedChannels', []));
            const [selectedReleaseNotes, setSelectedReleaseNotes] = useState(() => loadFromStorage('selectedReleaseNotes', []));
            const [selectedTriggers, setSelectedTriggers] = useState(() => loadFromStorage('selectedTriggers', []));
            const [selectedFreezes, setSelectedFreezes] = useState(() => loadFromStorage('selectedFreezes', []));
            const [promptText, setPromptText] = useState('');
            const [copyButtonText, setCopyButtonText] = useState('Copy to clipboard');

            const platforms = [
                { id: 'kubernetes', name: 'Kubernetes', icon: 'fas fa-dharmachakra', badge: 'Most Functional', prompt: 'Create a Kubernetes project called "My K8s WebApp", and then:\n* Configure the Kubernetes steps to use client side apply (client side apply is required by the "Mock K8s" target).\n* Disable verification checks in the Kubernetes steps (verification checks are not supported by the "Mock K8s" target).\n* Create a token account called "Mock Token".\n* Create a feed called "Docker Hub" pointing to "https://index.docker.io" using anonymous authentication.\n* Add a target called "Mock K8s", with the tag "Kubernetes", using the token account, pointing to "https://mockk8sserver.orangegrass-c0938ea8.westus2.azurecontainerapps.io", using the health check image "octopusdeploy/worker-tools:6.5.0-ubuntu.22.04" from the "Docker Hub" feed, using the worker pool "Hosted Ubuntu".' },
                { id: 'argocd', name: 'Argo CD', icon: 'fas fa-circle-nodes', prompt: 'Create an Argo CD project called "My Argo CD WebApp"' },
                { id: 'azurewebapp', name: 'Azure Web App', icon: 'fab fa-microsoft', prompt: 'Create an Azure Web App project called "My Azure WebApp"' },
                { id: 'azurefunctions', name: 'Azure Functions', icon: 'fas fa-bolt', prompt: 'Create an Azure Functions project called "My Azure Function App"' },
                { id: 'awslambda', name: 'AWS Lambda', icon: 'fab fa-aws', prompt: 'Create an AWS Lambda project called "My AWS Lambda App"' },
                { id: 'scriptstep', name: 'Script Step', icon: 'fas fa-terminal', badge: 'Most Flexible', prompt: 'Create a script project called "My Script App"' },
                { id: 'bluegreen', name: 'Blue/Green', icon: 'fas fa-exchange-alt', badge: 'Most Flexible', prompt: 'Create a Blue/Green deployment project called "My Blue Green App"' }
            ];

            const exampleSteps = [
                { id: 'smoketests', name: 'Smoke Tests', icon: 'fas fa-vial', instruction: '* Add a script step at the end of the deployment process to run smoke tests with a script that echoes "Running Smoke Test...".' },
                { id: 'slacknotification', name: 'Slack Notification', icon: 'fab fa-slack', instruction: '* Add a script step at the end of the deployment process to send a Slack notification with a script that echoes "Sending notification...".' },
                { id: 'openfirewall', name: 'Open Firewall', icon: 'fas fa-shield-alt', instruction: '* Add a step at the end of the deployment process to open the firewall with a script that echoes "Opening Firewall Ports...".' },
                { id: 'publishreleasenotes', name: 'Publish Release Notes', icon: 'fas fa-sticky-note', instruction: '* Add a step at the end of the deployment process to publish release notes with a script that echoes "Publishing Notes...".' },
                { id: 'manualintervention', name: 'Manual Intervention', icon: 'fas fa-hand-paper', instruction: '* Add a manual intervention step at the start of the deployment process, scoped to the "Production" environment.', platforms: ['scriptstep'] }
            ];

            const tenants = [
                { id: 'regional', name: 'Regional', icon: 'fas fa-globe', instruction: '* Add 5 tenants based on geographical regions, link the tenants to the project, and require tenants to deploy the project.' },
                { id: 'physical', name: 'Physical', icon: 'fas fa-building', instruction: '* Add 5 tenants based on fictional brick and mortar store names, link the tenants to the project, and require tenants to deploy the project.' },
                { id: 'businessunit', name: 'Business Unit', icon: 'fas fa-sitemap', instruction: '* Add 5 tenants based on fictional business unit names, link the tenants to the project, and require tenants to deploy the project.' },
                { id: 'company', name: 'Company', icon: 'fas fa-briefcase', instruction: '* Add 5 tenants based on fictional company names, link the tenants to the project, and require tenants to deploy the project.' }
            ];

            const runbooks = [
                { id: 'database', name: 'Database', icon: 'fas fa-database', instruction: '* Add a runbook to simulate a database backup scoped to the "Production" environment.' },
                { id: 'service', name: 'Service', icon: 'fas fa-cogs', instruction: '* Add a runbook to simulate the restart of the service scoped to the environments from the project\'s lifecycles.' },
                { id: 'logs', name: 'Logs', icon: 'fas fa-file-alt', instruction: '* Add a runbook to simulate the retrieval of logs scoped to the environments from the project\'s lifecycles.' }
            ];


            const channels = [
                { id: 'hotfix', name: 'Hot Fix', icon: 'fas fa-fire-extinguisher', instruction: '* Create a channel called "Hot Fix" using a lifecycle called "Hot Fix" that includes only the "Production" environment.' },
                { id: 'featurebranch', name: 'Feature Branch', icon: 'fas fa-code-branch', instruction: '* Create a channel called "Feature Branch" using a lifecycle called "Feature Branch" that includes only the "Feature Branch" environment.' }
            ];

            const releaseNotes = [
                { id: 'buildinformation', name: 'Build Information Release Notes', icon: 'fas fa-scroll', instruction: '* Add the following release notes to the project:\n' +
                        '```\n' +
                        'Here are the notes for the packages\n' +
                        '#{each package in Octopus.Release.Package}\n' +
                        '- #{package.PackageId} #{package.Version}\n' +
                        '#{each workItem in package.WorkItems}\n' +
                        '  - [#{workItem.Id}](#{workItem.LinkUrl}) - #{workItem.Description}\n' +
                        '#{/each}\n' +
                        '#{each commit in package.Commits}\n' +
                        '  - [#{commit.CommitId}](#{commit.LinkUrl}) - #{commit.Comment}\n' +
                        '#{/each}\n```' }
            ];

            const triggers = [
                { id: 'createrelease', name: 'Create Release on New Package', icon: 'fas fa-play-circle', instruction: '* Add a trigger to create a release when a new package is pushed to the feed.' }
            ];

            // Calculate freeze dates that are always in the future
            const calculateFreezeDates = () => {
                const now = new Date();
                const currentYear = now.getFullYear();
                const currentMonth = now.getMonth(); // 0-indexed (0 = January, 11 = December)
                const currentDay = now.getDate();

                // Determine which year to use for each freeze
                // Black Friday: November 23-29
                const blackFridayYear = (currentMonth === 10 && currentDay > 29) || currentMonth === 11 ? currentYear + 1 : currentYear;
                // Cyber Monday: November 30 - December 2
                const cyberMondayYear = (currentMonth === 11 && currentDay > 2) ? currentYear + 1 : currentYear;
                // Christmas: December 20-27
                const christmasYear = (currentMonth === 11 && currentDay > 27) ? currentYear + 1 : currentYear;

                return {
                    blackFriday: { year: blackFridayYear, start: `November 23rd, ${blackFridayYear}`, end: `November 29th, ${blackFridayYear}` },
                    cyberMonday: { year: cyberMondayYear, start: `November 30th, ${cyberMondayYear}`, end: `December 2nd, ${cyberMondayYear}` },
                    christmas: { year: christmasYear, start: `December 20th, ${christmasYear}`, end: `December 27th, ${christmasYear}` }
                };
            };

            const freezeDates = calculateFreezeDates();

            const freezes = [
                { id: 'blackfriday', name: 'Black Friday Freeze', icon: 'fas fa-snowflake', instruction: `* Add a global deployment freeze for Black Friday that prevents deployments from ${freezeDates.blackFriday.start} to ${freezeDates.blackFriday.end}.` },
                { id: 'cybermonday', name: 'Cyber Monday Freeze', icon: 'fas fa-snowflake', instruction: `* Add a global deployment freeze for Cyber Monday that prevents deployments from ${freezeDates.cyberMonday.start} to ${freezeDates.cyberMonday.end}.` },
                { id: 'christmas', name: 'Christmas Freeze', icon: 'fas fa-snowflake', instruction: `* Add a global deployment freeze for Christmas that prevents deployments from ${freezeDates.christmas.start} to ${freezeDates.christmas.end}.` }
            ];

            // Save to localStorage whenever selections change
            useEffect(() => {
                localStorage.setItem('selectedPlatform', JSON.stringify(selectedPlatform));
            }, [selectedPlatform]);

            useEffect(() => {
                localStorage.setItem('selectedExampleSteps', JSON.stringify(selectedExampleSteps));
            }, [selectedExampleSteps]);

            useEffect(() => {
                localStorage.setItem('selectedTenant', JSON.stringify(selectedTenant));
            }, [selectedTenant]);

            useEffect(() => {
                localStorage.setItem('selectedRunbooks', JSON.stringify(selectedRunbooks));
            }, [selectedRunbooks]);

            useEffect(() => {
                localStorage.setItem('selectedChannels', JSON.stringify(selectedChannels));
            }, [selectedChannels]);

            useEffect(() => {
                localStorage.setItem('selectedReleaseNotes', JSON.stringify(selectedReleaseNotes));
            }, [selectedReleaseNotes]);

            useEffect(() => {
                localStorage.setItem('selectedTriggers', JSON.stringify(selectedTriggers));
            }, [selectedTriggers]);

            useEffect(() => {
                localStorage.setItem('selectedFreezes', JSON.stringify(selectedFreezes));
            }, [selectedFreezes]);

            // Generate prompt on initial load and when selections change
            useEffect(() => {
                const prompt = generatePrompt(selectedPlatform, selectedExampleSteps, selectedTenant, selectedRunbooks, selectedChannels, selectedReleaseNotes, selectedTriggers, selectedFreezes);
                setPromptText(prompt);
            }, [selectedPlatform, selectedExampleSteps, selectedTenant, selectedRunbooks, selectedChannels, selectedReleaseNotes, selectedTriggers, selectedFreezes]);

            // Check if features should be disabled when a tenant is selected OR when feature limit is reached
            // Feature limit depends on platform: Script Step and Blue/Green allow 4, others allow 1
            const totalFeaturesSelected = selectedExampleSteps.length + selectedRunbooks.length + selectedChannels.length + selectedReleaseNotes.length + selectedTriggers.length + selectedFreezes.length;
            const featureLimit = (selectedPlatform === 'scriptstep' || selectedPlatform === 'bluegreen') ? 4 : 1;
            const isFeaturesDisabled = selectedTenant !== null || totalFeaturesSelected >= featureLimit;

            // Clear features when a tenant is selected
            useEffect(() => {
                if (selectedTenant !== null) {
                    if (selectedExampleSteps.length > 0) {
                        setSelectedExampleSteps([]);
                    }
                    if (selectedRunbooks.length > 0) {
                        setSelectedRunbooks([]);
                    }
                    if (selectedChannels.length > 0) {
                        setSelectedChannels([]);
                    }
                    if (selectedReleaseNotes.length > 0) {
                        setSelectedReleaseNotes([]);
                    }
                    if (selectedTriggers.length > 0) {
                        setSelectedTriggers([]);
                    }
                    if (selectedFreezes.length > 0) {
                        setSelectedFreezes([]);
                    }
                }
            }, [selectedTenant]);

            // Clear manual intervention when platform is not scriptstep
            useEffect(() => {
                if (selectedPlatform !== 'scriptstep' && selectedExampleSteps.includes('manualintervention')) {
                    setSelectedExampleSteps(selectedExampleSteps.filter(id => id !== 'manualintervention'));
                }
            }, [selectedPlatform]);

            // Clear triggers when platform is scriptstep or bluegreen
            useEffect(() => {
                if ((selectedPlatform === 'scriptstep' || selectedPlatform === 'bluegreen') && selectedTriggers.length > 0) {
                    setSelectedTriggers([]);
                }
            }, [selectedPlatform]);

            const generatePrompt = (platformId, exampleStepsIds, tenantId, runbookIds, channelIds, releaseNotesIds, triggersIds, freezesIds) => {
                const platform = platforms.find(p => p.id === platformId);
                if (!platform) return '';

                let prompt = platform.prompt;
                const additionalInstructions = [];

                if (exampleStepsIds && exampleStepsIds.length > 0) {
                    exampleStepsIds.forEach(stepId => {
                        const step = exampleSteps.find(s => s.id === stepId);
                        if (step && step.instruction) {
                            additionalInstructions.push(step.instruction);
                        }
                    });
                }

                if (tenantId) {
                    const tenant = tenants.find(t => t.id === tenantId);
                    if (tenant && tenant.instruction) {
                        additionalInstructions.push(tenant.instruction);
                        // Only add this message for Kubernetes platform
                        if (platformId === 'kubernetes') {
                            additionalInstructions.push('* Configure all targets, accounts, and certificates to support tenanted and untenanted deployments. Link the tenants to all targets, accounts, and certificates.');
                        }
                    }
                }

                if (runbookIds && runbookIds.length > 0) {
                    runbookIds.forEach(runbookId => {
                        const runbook = runbooks.find(r => r.id === runbookId);
                        if (runbook && runbook.instruction) {
                            additionalInstructions.push(runbook.instruction);
                        }
                    });
                }


                if (channelIds && channelIds.length > 0) {
                    channelIds.forEach(channelId => {
                        const channel = channels.find(c => c.id === channelId);
                        if (channel && channel.instruction) {
                            additionalInstructions.push(channel.instruction);
                        }
                    });
                }

                if (releaseNotesIds && releaseNotesIds.length > 0) {
                    releaseNotesIds.forEach(releaseNoteId => {
                        const releaseNote = releaseNotes.find(r => r.id === releaseNoteId);
                        if (releaseNote && releaseNote.instruction) {
                            additionalInstructions.push(releaseNote.instruction);
                        }
                    });
                }

                if (triggersIds && triggersIds.length > 0) {
                    triggersIds.forEach(triggerId => {
                        const trigger = triggers.find(t => t.id === triggerId);
                        if (trigger && trigger.instruction) {
                            additionalInstructions.push(trigger.instruction);
                        }
                    });
                }

                if (freezesIds && freezesIds.length > 0) {
                    freezesIds.forEach(freezeId => {
                        const freeze = freezes.find(f => f.id === freezeId);
                        if (freeze && freeze.instruction) {
                            additionalInstructions.push(freeze.instruction);
                        }
                    });
                }

                if (additionalInstructions.length > 0) {
                    if (prompt.indexOf(', and then:') === -1) {
                        prompt += ', and then:\n'
                    } else {
                        prompt += '\n';
                    }
                    prompt += additionalInstructions.join('\n');
                }

                return prompt;
            };

            const handlePlatformClick = (platformId) => {
                if (selectedPlatform === platformId) return;
                setSelectedPlatform(platformId);
            };

            const handleExampleStepClick = (stepId) => {
                // Allow deselection even if disabled, but prevent new selections
                if (selectedExampleSteps.includes(stepId)) {
                    setSelectedExampleSteps(selectedExampleSteps.filter(id => id !== stepId));
                } else if (!isFeaturesDisabled) {
                    setSelectedExampleSteps([...selectedExampleSteps, stepId]);
                }
            };

            const handleTenantClick = (tenantId) => {
                const newTenantId = selectedTenant === tenantId ? null : tenantId;
                setSelectedTenant(newTenantId);
            };

            const handleRunbookClick = (runbookId) => {
                // Allow deselection even if disabled, but prevent new selections
                if (selectedRunbooks.includes(runbookId)) {
                    setSelectedRunbooks(selectedRunbooks.filter(id => id !== runbookId));
                } else if (!isFeaturesDisabled) {
                    setSelectedRunbooks([...selectedRunbooks, runbookId]);
                }
            };


            const handleChannelClick = (channelId) => {
                // Allow deselection even if disabled, but prevent new selections
                if (selectedChannels.includes(channelId)) {
                    setSelectedChannels(selectedChannels.filter(id => id !== channelId));
                } else if (!isFeaturesDisabled) {
                    setSelectedChannels([...selectedChannels, channelId]);
                }
            };

            const handleReleaseNotesClick = (releaseNoteId) => {
                // Allow deselection even if disabled, but prevent new selections
                if (selectedReleaseNotes.includes(releaseNoteId)) {
                    setSelectedReleaseNotes(selectedReleaseNotes.filter(id => id !== releaseNoteId));
                } else if (!isFeaturesDisabled) {
                    setSelectedReleaseNotes([...selectedReleaseNotes, releaseNoteId]);
                }
            };

            const handleTriggersClick = (triggerId) => {
                // Disable triggers for scriptstep and bluegreen platforms
                if (selectedPlatform === 'scriptstep' || selectedPlatform === 'bluegreen') {
                    return;
                }
                // Allow deselection even if disabled, but prevent new selections
                if (selectedTriggers.includes(triggerId)) {
                    setSelectedTriggers(selectedTriggers.filter(id => id !== triggerId));
                } else if (!isFeaturesDisabled) {
                    setSelectedTriggers([...selectedTriggers, triggerId]);
                }
            };

            const handleFreezesClick = (freezeId) => {
                // Allow deselection even if disabled, but prevent new selections
                if (selectedFreezes.includes(freezeId)) {
                    setSelectedFreezes(selectedFreezes.filter(id => id !== freezeId));
                } else if (!isFeaturesDisabled) {
                    setSelectedFreezes([...selectedFreezes, freezeId]);
                }
            };

            const handleCopyToClipboard = () => {
                navigator.clipboard.writeText(promptText).then(() => {
                    setCopyButtonText('Copied');
                    setTimeout(() => {
                        setCopyButtonText('Copy to clipboard');
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                });
            };

            const [curlButtonText, setCurlButtonText] = useState('Copy as curl');

            const handleCopyAsCurl = () => {
                const modifiedPrompt = promptText + '\nThe current space is "$OCTOPUS_CLI_SPACE".\nSet the prompt to false.';
                const jsonEscapedPrompt = JSON.stringify(modifiedPrompt);
                // Escape for bash: replace backslashes, double quotes, and backticks
                const bashEscapedPrompt = jsonEscapedPrompt.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/`/g, '\\`');
                const curlCommand = `curl -X POST -H "X-Octopus-ApiKey: $OCTOPUS_CLI_API_KEY" -H "X-Octopus-Server: $OCTOPUS_CLI_SERVER" -H "Content-Type: application/json" -d "{\\"messages\\": [{\\"content\\": ${bashEscapedPrompt}}]}" https://aiagent.octopus.com//api/form_handler`;

                navigator.clipboard.writeText(curlCommand).then(() => {
                    setCurlButtonText('Copied');
                    setTimeout(() => {
                        setCurlButtonText('Copy as curl');
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                });
            };

            return html`
                <div class="container mt-5 mb-5">
                    <h1 class="mb-4">Octopus Easy Mode</h1>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td colspan="8" class="text-center" style="font-size: 1.5rem; font-weight: 600; border-bottom-width: 0; padding: 32px">1. First, Select Platform</td>
                            </tr>
                            <tr>
                                <th scope="row">Platform</th>
                                ${platforms.map(platform => html`
                                    <td
                                        class="text-center platform-cell ${selectedPlatform === platform.id ? 'selected' : ''}"
                                        onClick=${() => handlePlatformClick(platform.id)}
                                    >
                                        ${platform.name}
                                        ${platform.badge && html`<span class="badge ${platform.id === 'kubernetes' ? 'bg-info' : 'bg-success'} ms-1">${platform.badge}</span>`}
                                        <br/>
                                        <i class="${platform.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <td colspan="8" class="text-center" style="font-size: 1.5rem; font-weight: 600; border-bottom-width: 0; padding: 32px">2. Then, Select Tenants</td>
                            </tr>
                            <tr>
                                <th scope="row">Tenants</th>
                                ${tenants.map(tenant => html`
                                    <td
                                        class="text-center platform-cell ${selectedTenant === tenant.id ? 'selected' : ''}"
                                        onClick=${() => handleTenantClick(tenant.id)}
                                    >
                                        ${tenant.name}<br/>
                                        <i class="${tenant.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr class="header-text-row">
                                <td colspan="8" class="text-center" style="font-size: 1.5rem; font-weight: 600; border-bottom-width: 0; padding: 32px">
                                    3. Or, Select Features
                                    ${isFeaturesDisabled && selectedTenant !== null && html`<div class="disabled-message" style="font-size: 1rem; margin-top: 0.5rem; color: #dc3545;">Prompt complexity limit reached. Disable tenants to select additional features.</div>`}
                                    ${isFeaturesDisabled && selectedTenant === null && totalFeaturesSelected >= featureLimit && html`<div class="disabled-message" style="font-size: 1rem; margin-top: 0.5rem; color: #dc3545;">Prompt complexity limit reached. Maximum ${featureLimit} feature${featureLimit > 1 ? 's' : ''} can be selected.</div>`}
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    Placeholder Steps
                                </th>
                                ${exampleSteps.filter(step => !step.platforms || step.platforms.includes(selectedPlatform)).map(step => html`
                                    <td
                                        class="text-center platform-cell ${selectedExampleSteps.includes(step.id) ? 'selected' : ''} ${isFeaturesDisabled && !selectedExampleSteps.includes(step.id) ? 'disabled' : ''}"
                                        onClick=${() => handleExampleStepClick(step.id)}
                                    >
                                        ${step.name}<br/>
                                        <i class="${step.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <th scope="row">
                                    Runbooks
                                </th>
                                ${runbooks.map(runbook => html`
                                    <td
                                        class="text-center platform-cell ${selectedRunbooks.includes(runbook.id) ? 'selected' : ''} ${isFeaturesDisabled && !selectedRunbooks.includes(runbook.id) ? 'disabled' : ''}"
                                        onClick=${() => handleRunbookClick(runbook.id)}
                                    >
                                        ${runbook.name}<br/>
                                        <i class="${runbook.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <th scope="row">
                                    Channels
                                </th>
                                ${channels.map(channel => html`
                                    <td
                                        class="text-center platform-cell ${selectedChannels.includes(channel.id) ? 'selected' : ''} ${isFeaturesDisabled && !selectedChannels.includes(channel.id) ? 'disabled' : ''}"
                                        onClick=${() => handleChannelClick(channel.id)}
                                    >
                                        ${channel.name}<br/>
                                        <i class="${channel.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <th scope="row">
                                    Release Notes
                                </th>
                                ${releaseNotes.map(releaseNote => html`
                                    <td
                                        class="text-center platform-cell ${selectedReleaseNotes.includes(releaseNote.id) ? 'selected' : ''} ${isFeaturesDisabled && !selectedReleaseNotes.includes(releaseNote.id) ? 'disabled' : ''}"
                                        onClick=${() => handleReleaseNotesClick(releaseNote.id)}
                                    >
                                        ${releaseNote.name}<br/>
                                        <i class="${releaseNote.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <th scope="row">
                                    Triggers
                                </th>
                                ${triggers.map(trigger => html`
                                    <td
                                        class="text-center platform-cell ${selectedTriggers.includes(trigger.id) ? 'selected' : ''} ${(isFeaturesDisabled && !selectedTriggers.includes(trigger.id)) || selectedPlatform === 'scriptstep' || selectedPlatform === 'bluegreen' ? 'disabled' : ''}"
                                        onClick=${() => handleTriggersClick(trigger.id)}
                                    >
                                        ${trigger.name}<br/>
                                        <i class="${trigger.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                            <tr>
                                <th scope="row">
                                    Freezes
                                </th>
                                ${freezes.map(freeze => html`
                                    <td
                                        class="text-center platform-cell ${selectedFreezes.includes(freeze.id) ? 'selected' : ''} ${isFeaturesDisabled && !selectedFreezes.includes(freeze.id) ? 'disabled' : ''}"
                                        onClick=${() => handleFreezesClick(freeze.id)}
                                    >
                                        ${freeze.name}<br/>
                                        <i class="${freeze.icon} fa-2x"></i>
                                    </td>
                                `)}
                            </tr>
                        </tbody>

                    </table>

                    <div class="mt-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="mb-0">Prompt</h3>
                            <div>
                                <button class="btn btn-primary copy-btn me-2" onClick=${handleCopyToClipboard}>
                                    <i class="fas fa-copy me-2"></i>${copyButtonText}
                                </button>
                                <button class="btn btn-secondary copy-btn" onClick=${handleCopyAsCurl}>
                                    <i class="fas fa-terminal me-2"></i>${curlButtonText}
                                </button>
                            </div>
                        </div>
                        <textarea
                            class="form-control"
                            rows="10"
                            placeholder="Enter your prompt here..."
                            value=${promptText}
                            onInput=${(e) => setPromptText(e.target.value)}
                        ></textarea>
                    </div>
                </div>
            `;
        }

        render(html`<${App} />`, document.getElementById('app'));
    </script>
</body>
</html>

